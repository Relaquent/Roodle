<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roodle - Multiplayer Kelime Oyunu</title>
<link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@300;400;500;600;700;800;900&family=Space+Mono:wght@400;700&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<style>
:root {
  --bg: #0a0a0f;
  --surface: #13131c;
  --surface2: #1c1c2a;
  --surface3: #252538;
  --border: #2f2f48;
  --accent: #00ffb3;
  --accent2: #00e1ff;
  --accent3: #ff0095;
  --accent4: #ffd600;
  --text: #f8f8ff;
  --text-muted: #9999bb;
  --correct: #00ffb3;
  --present: #ffd600;
  --absent: #404060;
  --correct-bg: #002a1f;
  --present-bg: #3d3400;
  --absent-bg: #1a1a24;
  --tile-size: 68px;
  --tile-gap: 10px;
  --font-display: 'Orbitron', sans-serif;
  --font-body: 'Urbanist', sans-serif;
  --font-mono: 'Space Mono', monospace;
  --radius: 14px;
  --shadow-sm: 0 2px 12px rgba(0,0,0,0.4);
  --shadow-md: 0 6px 24px rgba(0,0,0,0.5);
  --shadow-lg: 0 12px 48px rgba(0,0,0,0.6);
  --glow: 0 0 30px rgba(0,255,179,0.4);
  --glow-strong: 0 0 50px rgba(0,255,179,0.6);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: var(--font-body);
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  overflow-x: hidden;
  position: relative;
}

body::before {
  content: '';
  position: fixed;
  inset: 0;
  background: 
    radial-gradient(ellipse at top left, rgba(0,255,179,0.05) 0%, transparent 40%),
    radial-gradient(ellipse at bottom right, rgba(0,225,255,0.04) 0%, transparent 40%);
  pointer-events: none;
  z-index: 0;
  animation: bgPulse 15s ease-in-out infinite;
}

@keyframes bgPulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

body::after {
  content: '';
  position: fixed;
  inset: 0;
  background-image:
    linear-gradient(rgba(0,255,179,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,255,179,0.03) 1px, transparent 1px);
  background-size: 70px 70px;
  pointer-events: none;
  z-index: 0;
}

header {
  position: relative;
  z-index: 10;
  width: 100%;
  max-width: 680px;
  padding: 32px 40px 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.logo {
  font-family: var(--font-display);
  font-size: 42px;
  font-weight: 900;
  letter-spacing: -2px;
  background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 50%, var(--accent3) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  cursor: pointer;
  user-select: none;
  animation: logoGlow 4s ease-in-out infinite;
}

@keyframes logoGlow {
  0%, 100% { filter: drop-shadow(0 0 12px rgba(0,255,179,0.4)); }
  50% { filter: drop-shadow(0 0 24px rgba(0,255,179,0.7)); }
}

.header-controls {
  display: flex;
  gap: 14px;
  align-items: center;
}

.icon-btn {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 12px;
  color: var(--text-muted);
  cursor: pointer;
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  transition: all 0.4s cubic-bezier(0.34,1.56,0.64,1);
  box-shadow: var(--shadow-sm);
  position: relative;
  overflow: hidden;
}

.icon-btn:hover {
  border-color: var(--accent);
  color: var(--accent);
  transform: translateY(-3px) scale(1.08);
  box-shadow: var(--glow);
}

.user-profile {
  display: flex;
  align-items: center;
  gap: 12px;
  background: linear-gradient(135deg, var(--surface2) 0%, var(--surface3) 100%);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 8px 16px;
  box-shadow: var(--shadow-sm);
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
}

.user-profile:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
  border-color: var(--accent);
}

.user-avatar {
  width: 32px;
  height: 32px;
  border-radius: 8px;
  background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  font-weight: 800;
  color: var(--bg);
}

.user-info {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.user-nick {
  font-size: 14px;
  font-weight: 700;
  color: var(--text);
}

.user-rank {
  font-size: 10px;
  font-family: var(--font-mono);
  color: var(--accent);
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

.user-xp-bar {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: rgba(0,255,179,0.1);
  border-radius: 0 0 12px 12px;
  overflow: hidden;
}

.user-xp-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent) 0%, var(--accent2) 100%);
  transition: width 1s cubic-bezier(0.34,1.56,0.64,1);
  box-shadow: 0 0 10px var(--accent);
}

.connection-status {
  position: fixed;
  top: 20px;
  right: 20px;
  padding: 8px 16px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 12px;
  font-size: 12px;
  font-family: var(--font-mono);
  display: flex;
  align-items: center;
  gap: 8px;
  z-index: 1000;
}

.status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--absent);
  animation: statusPulse 2s ease-in-out infinite;
}

.status-dot.connected {
  background: var(--correct);
}

@keyframes statusPulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.mode-selector {
  position: relative;
  z-index: 10;
  width: 100%;
  max-width: 680px;
  padding: 24px 40px 0;
}

.mode-tabs {
  display: flex;
  gap: 10px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 8px;
  box-shadow: var(--shadow-md);
}

.mode-tab {
  flex: 1;
  background: transparent;
  border: none;
  border-radius: 12px;
  color: var(--text-muted);
  cursor: pointer;
  padding: 12px 18px;
  font-family: var(--font-body);
  font-size: 14px;
  font-weight: 700;
  transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1);
}

.mode-tab:hover {
  color: var(--text);
  background: var(--surface2);
  transform: translateY(-2px);
}

.mode-tab.active {
  background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
  color: var(--bg);
  box-shadow: var(--glow);
  transform: translateY(-2px);
}

.word-length-bar {
  position: relative;
  z-index: 10;
  width: 100%;
  max-width: 680px;
  padding: 20px 40px 0;
  display: flex;
  gap: 12px;
  align-items: center;
}

.wl-label {
  font-size: 12px;
  font-family: var(--font-mono);
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.2em;
  margin-right: 10px;
  font-weight: 600;
}

.wl-btn {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 12px;
  color: var(--text-muted);
  cursor: pointer;
  padding: 10px 20px;
  font-family: var(--font-mono);
  font-size: 15px;
  font-weight: 700;
  transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1);
  box-shadow: var(--shadow-sm);
}

.wl-btn:hover { 
  border-color: var(--accent); 
  color: var(--accent);
  transform: translateY(-2px) scale(1.05);
}

.wl-btn.active {
  background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
  border-color: transparent;
  color: var(--bg);
  font-weight: 800;
  box-shadow: var(--glow);
  transform: translateY(-2px);
}

.queue-section {
  position: relative;
  z-index: 10;
  width: 100%;
  max-width: 680px;
  padding: 20px 40px 0;
}

.queue-panel {
  background: linear-gradient(135deg, var(--surface2) 0%, var(--surface3) 100%);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 20px;
  box-shadow: var(--shadow-md);
}

.queue-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.queue-title {
  font-size: 18px;
  font-weight: 800;
  color: var(--text);
  font-family: var(--font-display);
}

.queue-btn {
  background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
  border: none;
  border-radius: 12px;
  color: var(--bg);
  cursor: pointer;
  padding: 12px 24px;
  font-family: var(--font-body);
  font-size: 14px;
  font-weight: 800;
  transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1);
  box-shadow: var(--glow);
}

.queue-btn:hover {
  transform: translateY(-3px) scale(1.05);
}

.queue-btn.searching {
  background: linear-gradient(135deg, var(--accent3) 0%, var(--accent4) 100%);
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.8; }
}

.queue-players {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.queue-player {
  display: flex;
  align-items: center;
  gap: 12px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px;
}

.player-avatar {
  width: 36px;
  height: 36px;
  border-radius: 8px;
  background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  font-weight: 800;
  color: var(--bg);
}

.player-details {
  flex: 1;
}

.player-name {
  font-size: 14px;
  font-weight: 700;
  color: var(--text);
}

.player-rank {
  font-size: 11px;
  font-family: var(--font-mono);
  color: var(--accent);
}

.opponent-panel {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 16px;
}

.opponent-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.opponent-progress {
  font-size: 13px;
  color: var(--text-muted);
  font-family: var(--font-mono);
}

.game-area {
  position: relative;
  z-index: 10;
  width: 100%;
  max-width: 680px;
  padding: 28px 40px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 24px;
  flex: 1;
}

.grid {
  display: flex;
  flex-direction: column;
  gap: var(--tile-gap);
}

.grid-row {
  display: flex;
  gap: var(--tile-gap);
}

.tile {
  width: var(--tile-size);
  height: var(--tile-size);
  border: 2px solid var(--border);
  border-radius: var(--radius);
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-display);
  font-size: 32px;
  font-weight: 800;
  color: var(--text);
  background: var(--surface);
  transition: all 0.3s;
  user-select: none;
  box-shadow: var(--shadow-sm);
}

.tile.filled {
  border-color: var(--accent);
  background: var(--surface2);
  animation: tilePop 0.2s cubic-bezier(0.34,1.56,0.64,1);
}

@keyframes tilePop {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.15); }
}

.tile.reveal {
  animation: tileFlip 0.6s cubic-bezier(0.34,1.56,0.64,1) forwards;
}

@keyframes tileFlip {
  0% { transform: rotateY(0); }
  50% { transform: rotateY(-90deg); }
  100% { transform: rotateY(0); }
}

.tile.correct {
  background: var(--correct-bg);
  border-color: var(--correct);
  color: var(--correct);
  box-shadow: 0 0 32px rgba(0,255,179,0.5);
}

.tile.present {
  background: var(--present-bg);
  border-color: var(--present);
  color: var(--present);
  box-shadow: 0 0 32px rgba(255,214,0,0.4);
}

.tile.absent {
  background: var(--absent-bg);
  border-color: var(--absent);
  color: var(--text-muted);
}

.tile.shake {
  animation: shake 0.6s;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  10%, 50%, 90% { transform: translateX(-10px); }
  30%, 70% { transform: translateX(10px); }
}

.tile.bounce {
  animation: bounce 1s cubic-bezier(0.34,1.56,0.64,1);
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  30% { transform: translateY(-30px) scale(1.1); }
  60% { transform: translateY(-10px); }
}

.keyboard {
  width: 100%;
  max-width: 600px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding-bottom: 28px;
}

.key-row {
  display: flex;
  gap: 10px;
  justify-content: center;
}

.key {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 12px;
  color: var(--text);
  cursor: pointer;
  height: 60px;
  min-width: 40px;
  flex: 1;
  max-width: 50px;
  font-family: var(--font-display);
  font-size: 16px;
  font-weight: 800;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  user-select: none;
  box-shadow: var(--shadow-sm);
}

.key:hover {
  background: var(--surface3);
  border-color: var(--accent);
  transform: translateY(-2px);
}

.key.wide {
  min-width: 70px;
  max-width: 90px;
  font-size: 14px;
}

.key.correct {
  background: var(--correct-bg);
  border-color: var(--correct);
  color: var(--correct);
}

.key.present {
  background: var(--present-bg);
  border-color: var(--present);
  color: var(--present);
}

.key.absent {
  background: var(--absent-bg);
  border-color: var(--absent);
  color: var(--text-muted);
}

.key.enter-key {
  background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
  border-color: transparent;
  color: var(--bg);
  box-shadow: var(--glow-strong);
}

.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.92);
  backdrop-filter: blur(16px);
  z-index: 100;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 28px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s;
}

.modal-overlay.show {
  opacity: 1;
  pointer-events: all;
}

.modal {
  background: linear-gradient(135deg, var(--surface) 0%, var(--surface2) 100%);
  border: 1px solid var(--border);
  border-radius: 28px;
  padding: 48px;
  max-width: 520px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: var(--shadow-lg);
  transform: translateY(40px) scale(0.9);
  transition: transform 0.5s cubic-bezier(0.34,1.56,0.64,1);
}

.modal-overlay.show .modal {
  transform: translateY(0) scale(1);
}

.modal h2 {
  font-family: var(--font-display);
  font-size: 32px;
  font-weight: 900;
  margin-bottom: 12px;
  background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 50%, var(--accent3) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.modal p {
  color: var(--text-muted);
  font-size: 15px;
  line-height: 1.7;
  margin-bottom: 24px;
}

.modal-close {
  position: absolute;
  top: 24px;
  right: 24px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 10px;
  color: var(--text-muted);
  width: 36px;
  height: 36px;
  cursor: pointer;
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
}

.modal-close:hover { 
  border-color: var(--accent); 
  color: var(--accent);
  transform: rotate(90deg);
}

.btn {
  padding: 16px 24px;
  border-radius: 14px;
  border: none;
  cursor: pointer;
  font-family: var(--font-body);
  font-size: 15px;
  font-weight: 800;
  transition: all 0.3s;
  box-shadow: var(--shadow-sm);
}

.btn-primary {
  background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
  color: var(--bg);
  box-shadow: var(--glow);
  width: 100%;
}

.btn-primary:hover { 
  transform: translateY(-3px) scale(1.02);
}

.toast-container {
  position: fixed;
  top: 120px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 999;
  display: flex;
  flex-direction: column;
  gap: 12px;
  pointer-events: none;
}

.toast {
  background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
  color: var(--bg);
  padding: 16px 32px;
  border-radius: 16px;
  font-family: var(--font-body);
  font-size: 15px;
  font-weight: 800;
  text-align: center;
  animation: toastIn 0.5s cubic-bezier(0.34,1.56,0.64,1), toastOut 0.4s ease 2.5s forwards;
  box-shadow: var(--glow-strong);
}

@keyframes toastIn {
  from { opacity: 0; transform: translateY(-30px) scale(0.7); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

@keyframes toastOut {
  from { opacity: 1; }
  to { opacity: 0; }
}

.xp-gain {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-family: var(--font-display);
  font-size: 48px;
  font-weight: 900;
  color: var(--accent);
  z-index: 1000;
  animation: xpGainAnim 2s ease-out forwards;
  pointer-events: none;
  text-shadow: 0 0 20px rgba(0,255,179,0.8);
}

@keyframes xpGainAnim {
  0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
  20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
  80% { opacity: 1; transform: translate(-50%, -80%) scale(1); }
  100% { opacity: 0; transform: translate(-50%, -100%) scale(0.8); }
}

#confetti-canvas {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 50;
}

@media (max-width: 480px) {
  :root { --tile-size: 56px; --tile-gap: 7px; }
  header { padding: 24px 24px 0; }
  .logo { font-size: 34px; }
  .mode-selector, .word-length-bar, .game-area, .queue-section { padding-left: 24px; padding-right: 24px; }
  .tile { font-size: 24px; }
  .key { height: 52px; font-size: 14px; }
  .modal { padding: 36px 28px; }
}
</style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>
<div class="toast-container" id="toast-container"></div>

<!-- Connection Status -->
<div class="connection-status">
  <div class="status-dot" id="status-dot"></div>
  <span id="status-text">Baƒülanƒ±yor...</span>
</div>

<header>
  <div class="logo">ROODLE by Relaquent</div>
  <div class="header-controls">
    <div class="user-profile" id="user-profile">
      <div class="user-avatar" id="user-avatar">üéÆ</div>
      <div class="user-info">
        <div class="user-nick" id="user-nick">Oyuncu</div>
        <div class="user-rank" id="user-rank">Yeni Doƒümu≈ü I</div>
      </div>
      <div class="user-xp-bar">
        <div class="user-xp-fill" id="user-xp-fill" style="width: 0%"></div>
      </div>
    </div>
    <button class="icon-btn" id="leaderboard-btn" title="Sƒ±ralama Tablosu">üèÜ</button>
    <button class="icon-btn" id="help-btn">‚ùì</button>
  </div>
</header>

<div class="mode-selector">
  <div class="mode-tabs">
    <button class="mode-tab" data-mode="daily">üìÖ G√ºnl√ºk</button>
    <button class="mode-tab" data-mode="unlimited">‚ôæÔ∏è Sƒ±nƒ±rsƒ±z</button>
    <button class="mode-tab active" data-mode="multiplayer">‚öîÔ∏è 1v1</button>
  </div>
</div>

<div class="word-length-bar">
  <span class="wl-label">Harf:</span>
  <button class="wl-btn active" data-len="5">5</button>
  <button class="wl-btn" data-len="4">4</button>
  <button class="wl-btn" data-len="6">6</button>
  <button class="wl-btn" data-len="7">7</button>
</div>

<div class="queue-section" id="queue-section">
  <div class="queue-panel">
    <div class="queue-header">
      <div class="queue-title">‚öîÔ∏è 1v1 M√ºcadele</div>
      <button class="queue-btn" id="queue-btn">Sƒ±raya Katƒ±l</button>
    </div>
    <div class="queue-players" id="queue-players"></div>
  </div>
</div>

<div class="game-area">
  <div id="opponent-panel" style="display: none;">
    <div class="opponent-panel">
      <div class="opponent-header">
        <div class="player-avatar" id="opponent-avatar">üë§</div>
        <div class="player-details">
          <div class="player-name" id="opponent-name">Rakip</div>
          <div class="player-rank" id="opponent-rank">-</div>
        </div>
      </div>
      <div class="opponent-progress" id="opponent-progress">Bekliyor...</div>
    </div>
  </div>
  <div id="turn-display" style="width: 100%; margin-bottom: 16px;"></div>
  <div class="grid" id="grid"></div>
  <div class="keyboard" id="keyboard"></div>
</div>

<!-- Profile Modal -->
<div class="modal-overlay" id="profile-modal">
  <div class="modal">
    <button class="modal-close" id="profile-close">‚úï</button>
    <h2>üë§ Profil</h2>
    <div style="margin: 24px 0;">
      <label style="display: block; margin-bottom: 12px; font-weight: 700;">Takma Adƒ±n:</label>
      <input type="text" id="nick-input" maxlength="16" placeholder="Adƒ±nƒ± gir..." style="width: 100%; padding: 14px; border-radius: 12px; border: 1px solid var(--border); background: var(--surface2); color: var(--text); font-family: var(--font-body); font-size: 16px;">
      
      <div style="margin-top: 24px; padding: 20px; background: var(--surface2); border-radius: 12px;">
        <div style="font-size: 32px; font-weight: 900; color: var(--accent); font-family: var(--font-display); margin-bottom: 8px;" id="profile-level">1</div>
        <div style="font-size: 14px; color: var(--text); font-weight: 700; margin-bottom: 12px;" id="profile-rank">Yeni Doƒümu≈ü I</div>
        <div style="height: 8px; background: rgba(0,255,179,0.1); border-radius: 4px; overflow: hidden; margin-bottom: 8px;">
          <div id="profile-xp-bar" style="height: 100%; background: linear-gradient(90deg, var(--accent) 0%, var(--accent2) 100%); width: 0%;"></div>
        </div>
        <div style="font-size: 12px; color: var(--text-muted); font-family: var(--font-mono);" id="profile-xp-text">0 / 100 XP</div>
        <div style="margin-top: 16px; font-size: 13px; color: var(--text-muted);">
          <div>Kazanma: <span id="profile-wins" style="color: var(--accent);">0</span></div>
          <div>Kaybetme: <span id="profile-losses" style="color: var(--accent3);">0</span></div>
          <div>Toplam: <span id="profile-total" style="color: var(--text);">0</span></div>
        </div>
      </div>
    </div>
    <button class="btn btn-primary" id="save-profile-btn">Kaydet</button>
  </div>
</div>

<!-- Help Modal -->
<div class="modal-overlay" id="help-modal">
  <div class="modal">
    <button class="modal-close" id="help-close">‚úï</button>
    <h2>Nasƒ±l Oynanƒ±r?</h2>
    <p>Rakibinden √∂nce gizli kelimeyi bul!</p>
    <p style="font-size:13px; margin-top:16px; line-height:1.8;">
      üü© = Doƒüru yerde<br>
      üü® = Yanlƒ±≈ü yerde<br>
      ‚¨õ = Kelimede yok
    </p>
    <div style="margin: 24px 0; padding: 20px; background: var(--surface2); border-radius: 12px;">
      <div style="font-weight: 700; margin-bottom: 12px; color: var(--accent);">‚ö° XP Sistemi:</div>
      <div style="font-size: 13px; line-height: 1.6; color: var(--text-muted);">
        Her oyun XP kazandƒ±rƒ±r. Kazandƒ±k√ßa daha fazla XP alƒ±rsƒ±n!<br>
        Seviye atla ve r√ºtbeni y√ºkselt.
      </div>
    </div>
    <button class="btn btn-primary" id="help-close-btn">Ba≈üla! üéÆ</button>
  </div>
</div>

<!-- Result Modal -->
<div class="modal-overlay" id="result-modal">
  <div class="modal">
    <h2 id="result-title">üéâ</h2>
    <p id="result-msg"></p>
    <div id="result-xp" style="margin: 20px 0; padding: 20px; background: var(--surface2); border-radius: 12px; text-align: center;">
      <div style="font-size: 14px; color: var(--text-muted); margin-bottom: 8px;">XP Kazandƒ±n!</div>
      <div style="font-size: 36px; font-weight: 900; color: var(--accent); font-family: var(--font-display);" id="result-xp-amount">+50</div>
    </div>
    <button class="btn btn-primary" id="result-new-btn">Yeni Oyun üé≤</button>
  </div>
</div>

<!-- Leaderboard Modal -->
<div class="modal-overlay" id="leaderboard-modal">
  <div class="modal">
    <button class="modal-close" id="leaderboard-close">‚úï</button>
    <h2>üèÜ Sƒ±ralama Tablosu</h2>
    <div id="leaderboard-content" style="max-height: 500px; overflow-y: auto; margin-top: 20px;"></div>
    <button class="btn btn-secondary" id="leaderboard-close-btn" style="margin-top: 20px;">Kapat</button>
  </div>
</div>

<script>
// ===== CONFIG =====
const SERVER_URL = 'https://roodles.onrender.com'; // Render URL'inizi buraya yazƒ±n
// Yerel test i√ßin: const SERVER_URL = 'http://localhost:3000';

// ===== GAME STATE =====
let socket = null;
let gameMode = 'multiplayer';
let wordLength = 5;
let targetWord = '';
let currentRow = 0;
let currentCol = 0;
let currentGuess = [];
let gameOver = false;
let board = [];
let keyStates = {};
let currentGameId = null;
let opponentData = null;

// Player profile
let playerProfile = {
  playerId: null,
  nick: 'Oyuncu',
  level: 1,
  rank: 'Yeni Doƒümu≈ü I',
  totalXP: 0,
  currentXP: 0,
  wins: 0,
  losses: 0,
  gamesPlayed: 0
};

const RANKS = {
  1: { name: "Yeni Doƒümu≈ü I", xpNeeded: 100 },
  2: { name: "Yeni Doƒümu≈ü II", xpNeeded: 150 },
  3: { name: "Yeni Doƒümu≈ü III", xpNeeded: 200 },
  4: { name: "Yeni Doƒümu≈ü IV", xpNeeded: 250 },
  5: { name: "Yeni Doƒümu≈ü V", xpNeeded: 300 },
  6: { name: "Amat√∂r I", xpNeeded: 400 },
  7: { name: "Amat√∂r II", xpNeeded: 500 },
  8: { name: "Amat√∂r III", xpNeeded: 600 },
  9: { name: "Amat√∂r IV", xpNeeded: 700 },
  10: { name: "Bilirki≈üi I", xpNeeded: 850 },
  15: { name: "Ustad I", xpNeeded: 1850 },
  20: { name: "General I", xpNeeded: 3400 },
  25: { name: "CEO I", xpNeeded: 6000 },
  30: { name: "G√∂rm√º≈ü Ge√ßirmi≈ü", xpNeeded: 10500 }
};

for (let i = 31; i <= 100; i++) {
  RANKS[i] = { name: "G√∂rm√º≈ü Ge√ßirmi≈ü", xpNeeded: RANKS[i-1].xpNeeded + 1200 };
}

const KB_ROWS = [
  ['E','R','T','Y','U','I','O','P','ƒû','√ú'],
  ['A','S','D','F','G','H','J','K','L','≈û','ƒ∞'],
  ['ENTER','Z','C','V','B','N','M','√ñ','√á','‚å´']
];

// ===== SOCKET CONNECTION =====
function connectToServer() {
  socket = io(SERVER_URL, {
    transports: ['websocket'],
    reconnection: true,
    reconnectionDelay: 1000,
    reconnectionAttempts: 5
  });

  socket.on('connect', () => {
    console.log('Connected to server');
    updateConnectionStatus(true);
    registerPlayer();
  });

  socket.on('disconnect', () => {
    console.log('Disconnected from server');
    updateConnectionStatus(false);
  });

  socket.on('player:registered', (data) => {
    console.log('Player registered:', data);
    if (data.progress) {
      playerProfile = { ...playerProfile, ...data.progress, playerId: data.playerId };
      updateProfileDisplay();
    }
  });

  socket.on('queue:joined', (data) => {
    console.log('Joined queue:', data);
    document.getElementById('queue-btn').textContent = 'Sƒ±radan √áƒ±k';
    document.getElementById('queue-btn').classList.add('searching');
    showToast('‚öîÔ∏è Rakip aranƒ±yor...');
  });

  socket.on('queue:update', (data) => {
    renderQueuePlayers(data.players || []);
  });

  socket.on('game:start', (data) => {
  console.log('Game started:', data);
  currentGameId = data.gameId;
  opponentData = data.opponent;
  wordLength = data.wordLength;
  
  document.getElementById('queue-btn').classList.remove('searching');
  document.getElementById('queue-section').style.display = 'none';
  
  showOpponentPanel();
  newGame();
  
  // Turn display
  if (data.yourTurn) {
    enableInput();
    updateTurnDisplay(true, opponentData.nick);
    showToast(`üéÆ Oyun ba≈üladƒ±! SENƒ∞N SIRAIN - Rakip: ${opponentData.nick}`);
  } else {
    disableInput();
    updateTurnDisplay(false, opponentData.nick);
    showToast(`üéÆ Oyun ba≈üladƒ±! RAKIP BA≈ûLIYOR - Rakip: ${opponentData.nick}`);
  }
});

  socket.on('game:guess:result', (data) => {
    console.log('Guess result:', data);
    revealRow(currentRow, data.guess, data.result, () => {
      if (data.won) {
        gameOver = true;
        setTimeout(() => {
          celebrateWin();
        }, 500);
      } else if (data.lost) {
        gameOver = true;
      } else {
        currentRow++;
        currentCol = 0;
        currentGuess = [];
      }
    });
  });

  socket.on('game:opponent:update', (data) => {
    updateOpponentProgress(data);
  });

  socket.on('game:end', (data) => {
  console.log('Game ended:', data);
  gameOver = true;
  targetWord = data.targetWord;
  
  if (data.progress) {
    playerProfile = { ...playerProfile, ...data.progress };
    updateProfileDisplay();
  }
  
  disableInput();
  updateTurnDisplay(false, '');
  
  setTimeout(() => showResultModalMultiplayer(data), 1000);
});

  // Turn-based events
socket.on('game:turn:start', (data) => {
  console.log('Your turn!', data);
  showToast('Senin sƒ±ran! üéØ');
  enableInput();
  updateTurnDisplay(true, opponentData?.nick || 'Rakip');
});

socket.on('game:opponent:guess', (data) => {
  console.log('Opponent guessed:', data);
  const { guess, result, opponentWon, yourTurn } = data;
  
  // Rakibin tahminini g√∂ster
  displayOpponentGuess(guess, result);
  
  if (opponentWon) {
    showToast('Rakibiniz kazandƒ±! üòî');
    gameOver = true;
    disableInput();
  } else if (yourTurn) {
    showToast('Senin sƒ±ran! üéØ');
    enableInput();
    updateTurnDisplay(true, opponentData?.nick || 'Rakip');
  } else {
    disableInput();
    updateTurnDisplay(false, opponentData?.nick || 'Rakip');
  }
});

// Leaderboard
socket.on('leaderboard:update', (data) => {
  console.log('Leaderboard updated:', data);
  renderLeaderboard(data.leaderboard);
});

  socket.on('error', (data) => {
    console.error('Server error:', data);
    showToast(data.message || 'Bir hata olu≈ütu');
  });
}

function registerPlayer() {
  if (!socket || !socket.connected) return;
  
  socket.emit('player:register', {
    playerId: playerProfile.playerId,
    nick: playerProfile.nick,
    level: playerProfile.level,
    rank: playerProfile.rank,
    preferredLength: wordLength
  });
}

function updateConnectionStatus(connected) {
  const dot = document.getElementById('status-dot');
  const text = document.getElementById('status-text');
  
  if (connected) {
    dot.classList.add('connected');
    text.textContent = 'Baƒülƒ±';
  } else {
    dot.classList.remove('connected');
    text.textContent = 'Baƒülantƒ± yok';
  }
}

// ===== QUEUE =====
document.getElementById('queue-btn').addEventListener('click', () => {
  if (!socket || !socket.connected) {
    showToast('Sunucuya baƒülanƒ±lamƒ±yor!');
    return;
  }

  const btn = document.getElementById('queue-btn');
  
  if (btn.classList.contains('searching')) {
    socket.emit('queue:leave');
    btn.textContent = 'Sƒ±raya Katƒ±l';
    btn.classList.remove('searching');
    document.getElementById('queue-players').innerHTML = '';
  } else {
    socket.emit('queue:join', { preferredLength: wordLength });
  }
});

function renderQueuePlayers(players) {
  const container = document.getElementById('queue-players');
  if (players.length === 0) {
    container.innerHTML = '<div style="text-align: center; color: var(--text-muted); padding: 20px;">Sƒ±rada ba≈üka oyuncu yok</div>';
    return;
  }
  
  container.innerHTML = players.map(p => `
    <div class="queue-player">
      <div class="player-avatar">${p.nick[0]}</div>
      <div class="player-details">
        <div class="player-name">${p.nick}</div>
        <div class="player-rank">${p.rank}</div>
      </div>
    </div>
  `).join('');
}

function showOpponentPanel() {
  if (!opponentData) return;
  
  document.getElementById('opponent-panel').style.display = 'block';
  document.getElementById('opponent-avatar').textContent = opponentData.nick[0];
  document.getElementById('opponent-name').textContent = opponentData.nick;
  document.getElementById('opponent-rank').textContent = opponentData.rank;
  document.getElementById('opponent-progress').textContent = 'Bekliyor...';
}

function updateOpponentProgress(data) {
  const progressEl = document.getElementById('opponent-progress');
  if (data.finished) {
    progressEl.textContent = data.won ? `‚úÖ Kazandƒ± (${data.guessCount}/6)` : '‚ùå Kaybetti';
  } else {
    progressEl.textContent = `Tahmin: ${data.guessCount}/6`;
  }
}

// ===== PROFILE =====
function saveProfile() {
  localStorage.setItem('roodle_profile', JSON.stringify(playerProfile));
}

function loadProfile() {
  const saved = localStorage.getItem('roodle_profile');
  if (saved) {
    playerProfile = JSON.parse(saved);
  } else {
    playerProfile.playerId = 'player_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
  }
  updateProfileDisplay();
}

function updateProfileDisplay() {
  const currentRank = RANKS[Math.min(playerProfile.level, 100)];
  const nextRank = RANKS[Math.min(playerProfile.level + 1, 100)];
  const xpNeeded = nextRank ? nextRank.xpNeeded - playerProfile.totalXP : 0;
  const xpProgress = nextRank && xpNeeded > 0 ? ((playerProfile.currentXP / xpNeeded) * 100) : 100;

  document.getElementById('user-nick').textContent = playerProfile.nick;
  document.getElementById('user-rank').textContent = currentRank.name;
  document.getElementById('user-xp-fill').style.width = `${Math.min(xpProgress, 100)}%`;
  document.getElementById('user-avatar').textContent = playerProfile.nick[0].toUpperCase();
}

// ===== GRID =====
function buildGrid() {
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  board = [];

  for (let r = 0; r < 6; r++) {
    const row = document.createElement('div');
    row.className = 'grid-row';
    const rowTiles = [];
    for (let c = 0; c < wordLength; c++) {
      const tile = document.createElement('div');
      tile.className = 'tile';
      row.appendChild(tile);
      rowTiles.push(tile);
    }
    grid.appendChild(row);
    board.push(rowTiles);
  }
}

// ===== KEYBOARD =====
function buildKeyboard() {
  const kb = document.getElementById('keyboard');
  kb.innerHTML = '';
  keyStates = {};
  
  KB_ROWS.forEach(row => {
    const rowEl = document.createElement('div');
    rowEl.className = 'key-row';
    row.forEach(k => {
      const btn = document.createElement('button');
      btn.className = 'key' + (k === 'ENTER' ? ' wide enter-key' : k === '‚å´' ? ' wide' : '');
      btn.textContent = k;
      btn.dataset.key = k;
      btn.addEventListener('click', () => handleKey(k));
      rowEl.appendChild(btn);
      if (k !== 'ENTER' && k !== '‚å´') keyStates[k] = 'none';
    });
    kb.appendChild(rowEl);
  });
}

// ===== INPUT =====
document.addEventListener('keydown', e => {
  if (gameOver) return;
  if (document.querySelector('.modal-overlay.show')) return;

  const key = e.key.toUpperCase();
  if (key === 'ENTER') handleKey('ENTER');
  else if (key === 'BACKSPACE' || key === 'DELETE') handleKey('‚å´');
  else if (/^[A-Z√áƒûƒ∞√ñ≈û√ú]$/.test(key)) handleKey(key);
});

function handleKey(key) {
  if (gameOver) return;
  if (key === 'ENTER') submitGuess();
  else if (key === '‚å´') deleteLetter();
  else if (currentCol < wordLength && /^[A-Z√áƒûƒ∞√ñ≈û√ú]$/.test(key)) addLetter(key);
}

function addLetter(letter) {
  if (currentCol >= wordLength) return;
  currentGuess[currentCol] = letter;
  const tile = board[currentRow][currentCol];
  tile.textContent = letter;
  tile.classList.add('filled');
  currentCol++;
}

function deleteLetter() {
  if (currentCol <= 0) return;
  currentCol--;
  currentGuess[currentCol] = '';
  const tile = board[currentRow][currentCol];
  tile.textContent = '';
  tile.classList.remove('filled');
}

// ===== SUBMIT =====
function submitGuess() {
  if (currentCol < wordLength) {
    shakeRow(currentRow);
    showToast('Kelime √ßok kƒ±sa!');
    return;
  }

  const guess = currentGuess.join('');

  if (!socket || !socket.connected) {
    showToast('Sunucu baƒülantƒ±sƒ± yok!');
    return;
  }

  if (!currentGameId) {
    showToast('Aktif oyun yok!');
    return;
  }

  socket.emit('game:guess', {
    gameId: currentGameId,
    guess: guess
  });
}

// ===== REVEAL =====
function revealRow(row, guess, result, callback) {
  result.forEach((res, i) => {
    const tile = board[row][i];
    setTimeout(() => {
      tile.classList.add('reveal');
      setTimeout(() => {
        tile.classList.add(res);
        updateKeyState(guess[i], res);
      }, 300);
    }, i * 150);
  });

  setTimeout(callback, wordLength * 150 + 500);
}

function updateKeyState(letter, state) {
  const priority = { correct: 3, present: 2, absent: 1, none: 0 };
  const current = keyStates[letter] || 'none';
  if ((priority[state] || 0) > (priority[current] || 0)) {
    keyStates[letter] = state;
    const keyEl = document.querySelector(`.key[data-key="${letter}"]`);
    if (keyEl) {
      keyEl.classList.remove('correct','present','absent');
      if (state !== 'none') keyEl.classList.add(state);
    }
  }
}

function shakeRow(row) {
  board[row].forEach(tile => {
    tile.classList.add('shake');
    setTimeout(() => tile.classList.remove('shake'), 600);
  });
}

// ===== WIN =====
function celebrateWin() {
  showToast('üéâ KAZANDIN!');
  board[currentRow].forEach((tile, i) => {
    setTimeout(() => tile.classList.add('bounce'), i * 100);
  });
  launchConfetti();
}

function launchConfetti() {
  const canvas = document.getElementById('confetti-canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  const colors = ['#00ffb3','#00e1ff','#ff0095','#ffd600'];
  const particles = Array.from({length: 150}, () => ({
    x: Math.random() * canvas.width,
    y: -30,
    vx: (Math.random() - 0.5) * 10,
    vy: Math.random() * 6 + 3,
    color: colors[Math.floor(Math.random() * colors.length)],
    size: Math.random() * 10 + 4
  }));

  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach(p => {
      p.x += p.vx;
      p.y += p.vy;
      p.vy += 0.15;
      ctx.fillStyle = p.color;
      ctx.fillRect(p.x, p.y, p.size, p.size);
    });
    if (particles.some(p => p.y < canvas.height)) {
      requestAnimationFrame(animate);
    } else {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
  }
  animate();
}

// ===== TOAST =====
function showToast(msg) {
  const c = document.getElementById('toast-container');
  const t = document.createElement('div');
  t.className = 'toast';
  t.textContent = msg;
  c.appendChild(t);
  setTimeout(() => t.remove(), 2800);
}

// ===== RESULT MODAL =====
function showResultModal(data) {
  const modal = document.getElementById('result-modal');
  const title = document.getElementById('result-title');
  const msg = document.getElementById('result-msg');
  const xpAmount = document.getElementById('result-xp-amount');

  if (data.result === 'win') {
    title.textContent = 'üéâ KAZANDIN!';
    msg.textContent = `Rakibini ${data.opponent.guessCount - (currentRow + 1)} tahminle ge√ßtin!`;
  } else {
    title.textContent = 'üòî Kaybettin';
    msg.textContent = `Doƒüru kelime: ${data.targetWord}`;
  }

  xpAmount.textContent = `+${data.xpGained || 0}`;
  
  if (data.leveledUp) {
    setTimeout(() => {
      showToast(`üéä Seviye Atladƒ±n! ${RANKS[playerProfile.level].name}`);
      launchConfetti();
    }, 1000);
  }

  setTimeout(() => modal.classList.add('show'), 600);
}

// ===== NEW GAME =====
function newGame() {
  gameOver = false;
  currentRow = 0;
  currentCol = 0;
  currentGuess = [];
  
  buildGrid();
  buildKeyboard();
}

document.getElementById('result-new-btn').addEventListener('click', () => {
  document.getElementById('result-modal').classList.remove('show');
  document.getElementById('opponent-panel').style.display = 'none';
  document.getElementById('queue-section').style.display = 'block';
  currentGameId = null;
  opponentData = null;
  newGame();
});

// ===== PROFILE MODAL =====
document.getElementById('user-profile').addEventListener('click', () => {
  document.getElementById('nick-input').value = playerProfile.nick;
  document.getElementById('profile-level').textContent = playerProfile.level;
  document.getElementById('profile-rank').textContent = RANKS[playerProfile.level].name;
  
  const nextRank = RANKS[Math.min(playerProfile.level + 1, 100)];
  const xpNeeded = nextRank ? nextRank.xpNeeded - playerProfile.totalXP : 0;
  const xpProgress = nextRank && xpNeeded > 0 ? ((playerProfile.currentXP / xpNeeded) * 100) : 100;
  
  document.getElementById('profile-xp-bar').style.width = `${Math.min(xpProgress, 100)}%`;
  document.getElementById('profile-xp-text').textContent = `${playerProfile.currentXP} / ${xpNeeded} XP`;
  document.getElementById('profile-wins').textContent = playerProfile.wins || 0;
  document.getElementById('profile-losses').textContent = playerProfile.losses || 0;
  document.getElementById('profile-total').textContent = playerProfile.gamesPlayed || 0;
  
  document.getElementById('profile-modal').classList.add('show');
});

document.getElementById('save-profile-btn').addEventListener('click', () => {
  const newNick = document.getElementById('nick-input').value.trim();
  if (newNick && newNick.length > 0) {
    playerProfile.nick = newNick;
    saveProfile();
    updateProfileDisplay();
    registerPlayer();
    showToast('‚úÖ Profil kaydedildi!');
    document.getElementById('profile-modal').classList.remove('show');
  }
});

document.getElementById('profile-close').addEventListener('click', () => {
  document.getElementById('profile-modal').classList.remove('show');
});

// ===== HELP MODAL =====
document.getElementById('help-btn').addEventListener('click', () => {
  document.getElementById('help-modal').classList.add('show');
});

// Leaderboard modal
document.getElementById('leaderboard-btn').addEventListener('click', () => {
  if (socket && socket.connected) {
    socket.emit('leaderboard:get');
  } else {
    showToast('Leaderboard i√ßin sunucuya baƒülanmalƒ±sƒ±nƒ±z!');
  }
  document.getElementById('leaderboard-modal').classList.add('show');
});

document.getElementById('leaderboard-close').addEventListener('click', () => {
  document.getElementById('leaderboard-modal').classList.remove('show');
});

document.getElementById('leaderboard-close-btn').addEventListener('click', () => {
  document.getElementById('leaderboard-modal').classList.remove('show');
});
document.getElementById('help-close').addEventListener('click', () => {
  document.getElementById('help-modal').classList.remove('show');
});
document.getElementById('help-close-btn').addEventListener('click', () => {
  document.getElementById('help-modal').classList.remove('show');
});

document.querySelectorAll('.modal-overlay').forEach(overlay => {
  overlay.addEventListener('click', e => {
    if (e.target === overlay) overlay.classList.remove('show');
  });
});

// ===== WORD LENGTH =====
document.querySelectorAll('.wl-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const len = parseInt(btn.dataset.len);
    if (len === wordLength) return;
    
    document.querySelectorAll('.wl-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    wordLength = len;
    
    showToast(`${len} harfli kelimeler se√ßildi`);
  });
});

// ===== TURN DISPLAY =====
function updateTurnDisplay(isYourTurn, opponentNick) {
  const turnDisplay = document.getElementById('turn-display');
  if (!turnDisplay) return;
  
  if (gameMode !== 'multiplayer' || !currentGameId) {
    turnDisplay.innerHTML = '';
    return;
  }
  
  if (isYourTurn) {
    turnDisplay.innerHTML = `
      <div style="
        background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
        color: var(--bg);
        padding: 12px 24px;
        border-radius: 12px;
        font-weight: 800;
        text-align: center;
        animation: pulse 1.5s ease-in-out infinite;
        box-shadow: var(--glow);
      ">
        ‚ö° Senin Sƒ±ran!
      </div>
    `;
  } else {
    turnDisplay.innerHTML = `
      <div style="
        background: var(--surface2);
        border: 1px solid var(--border);
        color: var(--text-muted);
        padding: 12px 24px;
        border-radius: 12px;
        font-weight: 700;
        text-align: center;
      ">
        ‚è≥ ${opponentNick}'in sƒ±rasƒ±...
      </div>
    `;
  }
}

function enableInput() {
  document.querySelectorAll('.key').forEach(key => {
    key.style.pointerEvents = 'all';
    key.style.opacity = '1';
  });
}

function disableInput() {
  document.querySelectorAll('.key').forEach(key => {
    key.style.pointerEvents = 'none';
    key.style.opacity = '0.5';
  });
}

// ===== OPPONENT GUESS DISPLAY =====
function displayOpponentGuess(guess, result) {
  // Bo≈ü satƒ±r bul
  for (let row = 0; row < board.length; row++) {
    const firstTile = board[row][0];
    if (!firstTile.textContent || firstTile.textContent === '') {
      // Bu satƒ±ra rakibin tahminini yaz
      guess.split('').forEach((letter, col) => {
        if (col >= wordLength) return;
        
        const tile = board[row][col];
        tile.textContent = letter;
        tile.classList.add('filled');
        
        setTimeout(() => {
          tile.classList.add('reveal');
          setTimeout(() => {
            tile.classList.add(result[col]);
            updateKeyState(letter, result[col]);
          }, 300);
        }, col * 150);
      });
      
      break;
    }
  }
}

// ===== LEADERBOARD =====
function renderLeaderboard(data) {
  const container = document.getElementById('leaderboard-content');
  if (!container) return;
  
  if (!data || data.length === 0) {
    container.innerHTML = `
      <div style="text-align: center; padding: 40px; color: var(--text-muted);">
        Hen√ºz sƒ±ralamada kimse yok
      </div>
    `;
    return;
  }
  
  container.innerHTML = `
    <div style="display: flex; flex-direction: column; gap: 8px;">
      ${data.map((player, index) => {
        const medalEmoji = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : '';
        const isTopThree = index < 3;
        
        return `
          <div style="
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: ${isTopThree ? 'linear-gradient(135deg, var(--surface2), var(--surface3))' : 'var(--surface2)'};
            border: 1px solid ${isTopThree ? 'var(--accent)' : 'var(--border)'};
            border-radius: 12px;
            transition: all 0.3s;
            cursor: pointer;
          " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='var(--shadow-md)'" onmouseout="this.style.transform=''; this.style.boxShadow=''">
            
            <div style="
              min-width: 50px;
              height: 50px;
              background: ${index < 3 ? (index === 0 ? 'linear-gradient(135deg, #FFD700, #FFA500)' : index === 1 ? 'linear-gradient(135deg, #C0C0C0, #808080)' : 'linear-gradient(135deg, #CD7F32, #8B4513)') : 'var(--surface3)'};
              border-radius: 10px;
              display: flex;
              align-items: center;
              justify-content: center;
              font-weight: 900;
              font-size: 20px;
              color: ${isTopThree ? '#000' : 'var(--text)'};
              font-family: var(--font-display);
            ">
              ${medalEmoji || (index + 1)}
            </div>
            
            <div style="flex: 1;">
              <div style="font-size: 16px; font-weight: 700; color: var(--text); margin-bottom: 4px;">
                ${player.nick}
              </div>
              <div style="font-size: 12px; color: var(--text-muted); font-family: var(--font-mono);">
                W: ${player.wins || 0} | L: ${player.losses || 0} | D: ${player.draws || 0}
                ${player.winStreak > 0 ? ` | üî• ${player.winStreak}` : ''}
              </div>
            </div>
            
            <div style="text-align: right;">
              <div style="font-size: 24px; font-weight: 900; color: var(--accent); font-family: var(--font-display);">
                ${player.rankedPoints}
              </div>
              <div style="font-size: 11px; color: var(--text-muted); font-family: var(--font-mono); margin-top: 2px;">
                Lvl ${player.level}
              </div>
            </div>
          </div>
        `;
      }).join('')}
    </div>
  `;
}

// ===== MULTIPLAYER RESULT MODAL =====
function showResultModalMultiplayer(data) {
  const modal = document.getElementById('result-modal');
  const title = document.getElementById('result-title');
  const msg = document.getElementById('result-msg');
  const answerDiv = document.getElementById('result-answer');
  const wordEl = document.getElementById('result-word');
  const xpAmount = document.getElementById('result-xp-amount');

  if (data.result === 'win') {
    title.textContent = 'üéâ KAZANDIN!';
    msg.innerHTML = `
      Rakibini yendin!<br>
      <div style="margin-top: 12px; padding: 12px; background: var(--surface3); border-radius: 8px;">
        <span style="color: ${data.rankedChange > 0 ? 'var(--accent)' : 'var(--accent3)'}; font-weight: 900; font-size: 20px;">
          ${data.rankedChange > 0 ? '+' : ''}${data.rankedChange} Ranked Puan
        </span><br>
        <span style="font-size: 14px; color: var(--text-muted); margin-top: 4px; display: block;">
          Yeni Puan: ${data.newRankedPoints}
        </span>
      </div>
    `;
    answerDiv.style.display = 'none';
  } else if (data.result === 'lose') {
    title.textContent = 'üòî Kaybettin';
    msg.innerHTML = `
      Rakibin kazandƒ±<br>
      <div style="margin-top: 12px; padding: 12px; background: var(--surface3); border-radius: 8px;">
        <span style="color: var(--accent3); font-weight: 900; font-size: 20px;">
          ${data.rankedChange} Ranked Puan
        </span><br>
        <span style="font-size: 14px; color: var(--text-muted); margin-top: 4px; display: block;">
          Yeni Puan: ${data.newRankedPoints}
        </span>
      </div>
    `;
    answerDiv.style.display = 'block';
    if (wordEl) wordEl.textContent = data.targetWord;
  } else if (data.result === 'draw') {
    title.textContent = 'ü§ù Beraberlik!';
    msg.innerHTML = `
      Kimse bulamadƒ±<br>
      <div style="margin-top: 12px; padding: 12px; background: var(--surface3); border-radius: 8px;">
        <span style="color: var(--accent4); font-weight: 900; font-size: 20px;">
          ${data.rankedChange > 0 ? '+' : ''}${data.rankedChange} Ranked Puan
        </span><br>
        <span style="font-size: 14px; color: var(--text-muted); margin-top: 4px; display: block;">
          Yeni Puan: ${data.newRankedPoints}
        </span>
      </div>
    `;
    answerDiv.style.display = 'block';
    if (wordEl) wordEl.textContent = data.targetWord;
  }

  xpAmount.textContent = `+${data.xpGained}`;
  
  if (data.leveledUp) {
    setTimeout(() => {
      showToast(`üéä Seviye Atladƒ±n! ${RANKS[playerProfile.level].name}`);
      launchConfetti();
    }, 1000);
  }

  setTimeout(() => modal.classList.add('show'), 600);
}

// ===== INIT =====
function init() {
  loadProfile();
  buildGrid();
  buildKeyboard();
  connectToServer();
  
  if (!localStorage.getItem('roodle_seen_help')) {
    setTimeout(() => {
      document.getElementById('help-modal').classList.add('show');
      localStorage.setItem('roodle_seen_help', '1');
    }, 1000);
  }
}

window.addEventListener('resize', () => {
  const canvas = document.getElementById('confetti-canvas');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});

init();
</script>
</body>
</html>
